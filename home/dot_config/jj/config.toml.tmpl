"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "Don Petersen"
email = {{ .email | quote }}

[ui]
default-command = ["log", "--no-pager"]
diff-formatter = "delta"
diff-editor = ["nvim", "-c", "DiffEditor $left $right $output"]

[revset-aliases]
mylocalbookmarks = "bookmarks() & mine()"
mylocal = "visible_heads() & mine()"

[merge-tools.diffconflicts]
program = "nvim"
merge-args = [
        "-c",
        "let g:jj_diffconflicts_marker_length=$marker_length",
        "-c",
        "JJDiffConflicts!",
        "$output",
        "$base",
        "$left",
        "$right",
]
merge-tool-edits-conflict-markers = true

# Delta exits with code 1 when differences exist (standard diff behavior).
# Without this, jj shows a warning after every diff command.
# https://github.com/jj-vcs/jj/issues/5250
[merge-tools.delta]
diff-expected-exit-codes = [0, 1]

# This does have a bug where it will format schema.rb. I'm not sure there's an
# easy way to fix this with JJ's current capabilities.
[fix.tools.standardrb]
command = ["bin/standardrb", "--fix", "--stdin", "$path", "--stderr"]
patterns = ["glob:'**/*.rb'", "glob:'**/*.rake'"]

# Source: https://www.aazuspan.dev/blog/til-configuring-jj-fix-with-ruff/
[fix.tools.1-ruff-lint]
command = [
        "uv",
        "run",
        "ruff",
        "check",
        "--fix",
        "--preview",
        "--quiet",
        "--stdin-filename=$path",
        "-",
]
patterns = ["glob:'**/*.py'"]

# Source: https://www.aazuspan.dev/blog/til-configuring-jj-fix-with-ruff/
[fix.tools.2-ruff-format]
command = ["uv", "run", "ruff", "format", "--stdin-filename=$path", "-"]
patterns = ["glob:'**/*.py'"]

[git]
colocate = true
